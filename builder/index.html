<!DOCTYPE html>
<html data-theme="dark">
<head>
  <meta charset="utf-8" />
  <title>Builder | Cooper Course Graph</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../main/css/styles.css" />
  <style>
    :root {
      --accent: var(--link-color);
      --accent-hover: var(--link-hover);
      --panel-radius: 12px;
      --panel-padding: 16px;
      --fighter-bg: #0f0f14;
      --fighter-border: #ffcc33;
      --fighter-glow: rgba(255, 204, 51, 0.4);
      --win-bg: #0e1b10;
      --win-border: #37d67a;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(0, 102, 204, 0.12), transparent 55%),
                  linear-gradient(135deg, rgba(255, 255, 255, 0.06), transparent 45%),
                  var(--bg-color);
      color: var(--text-color);
      padding: 24px;
    }

    .construction-card {
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: var(--panel-radius);
      box-shadow: var(--card-shadow);
      padding: 20px 24px;
      font-size: 14px;
      line-height: 1.5;
      text-align: center;
      max-width: 420px;
    }

    .construction-btn {
      display: inline;
      padding: 0;
      margin: 0;
      border: 0;
      background: transparent;
      color: inherit;
      font: inherit;
      font-weight: inherit;
      letter-spacing: inherit;
      line-height: inherit;
      cursor: pointer;
      transition: color 0.2s ease, text-shadow 0.2s ease;
    }

    .construction-btn:hover {
      color: var(--accent);
      text-shadow: 0 0 12px rgba(0, 102, 204, 0.35);
    }

    .overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(7, 7, 12, 0.72);
      backdrop-filter: blur(4px);
      z-index: 10000;
      padding: 24px;
    }

    .overlay.hidden {
      display: none;
    }

    .panel {
      width: min(920px, 92vw);
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: var(--panel-radius);
      box-shadow: var(--card-shadow);
      padding: var(--panel-padding);
    }

    .fighter-panel {
      background: radial-gradient(circle at top, rgba(255, 204, 51, 0.15), transparent 55%),
                  linear-gradient(180deg, rgba(0, 0, 0, 0.75), rgba(10, 10, 20, 0.95));
      border: 2px solid var(--fighter-border);
      box-shadow: 0 0 24px var(--fighter-glow);
    }

    .fighter-header {
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-align: center;
      color: #f8f3d4;
      margin-bottom: 16px;
      text-shadow: 0 0 8px rgba(255, 204, 51, 0.6);
    }

    .fighter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
    }

    .fighter-card {
      background: #14141c;
      border: 2px solid #2a2a34;
      border-radius: 10px;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .fighter-card:hover {
      transform: translateY(-4px);
      border-color: var(--fighter-border);
      box-shadow: 0 0 16px var(--fighter-glow);
    }

    .fighter-card img {
      max-width: 100%;
      max-height: 160px;
      object-fit: contain;
      display: block;
    }

    .fighter-card img.fighter-zoom {
      transform: scale(1.86);
      transform-origin: center;
    }

    .game-panel {
      width: min(520px, 92vw);
      display: grid;
      gap: 12px;
      justify-items: center;
      background: linear-gradient(180deg, rgba(15, 20, 36, 0.95), rgba(0, 0, 0, 0.85));
      border: 2px solid var(--panel-border);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
    }

    .game-header {
      width: 100%;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 12px;
    }

    .score-pill {
      background: rgba(0, 0, 0, 0.45);
      border: 1px solid var(--panel-border);
      border-radius: 999px;
      padding: 4px 12px;
      color: var(--text-color);
      font-size: 12px;
      font-weight: 700;
      min-width: 90px;
      text-align: center;
    }

    .game-close {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      border: 1px solid var(--panel-border);
      background: rgba(0, 0, 0, 0.45);
      color: var(--text-color);
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
    }

    .game-close:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    #death-overlay img {
      width: 100vw;
      max-width: 100vw;
      height: auto;
      display: block;
      opacity: 0;
      transform: scale(1);
      transform-origin: center;
      animation: youdied-fade 3s linear forwards, youdied-zoom 10s linear forwards;
    }

    @keyframes youdied-fade {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes youdied-zoom {
      from { transform: scale(1); }
      to { transform: scale(1.06); }
    }

    .game-canvas {
      width: min(420px, 78vw);
      aspect-ratio: 1 / 1;
      background: #0b0f1c;
      border: 2px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      display: block;
    }

    .game-note {
      font-size: 11px;
      color: var(--note-color);
    }

    .win-panel {
      background: var(--win-bg);
      border: 2px solid var(--win-border);
      box-shadow: 0 0 24px rgba(55, 214, 122, 0.45);
      padding: 18px 26px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #c9ffd7;
      border-radius: 10px;
    }

    @media (max-width: 640px) {
      .fighter-header {
        font-size: 18px;
      }
      .fighter-card img {
        max-height: 120px;
      }
    }
  </style>
</head>
<body>
  <main class="construction-card" role="main">
    <span>This page is currently under </span>
    <button id="construction-btn" class="construction-btn" type="button">construction</button>
  </main>

  <div id="fighter-overlay" class="overlay hidden" role="dialog" aria-modal="true">
    <div class="panel fighter-panel">
      <div class="fighter-header">Choose Your Fighter</div>
      <div class="fighter-grid" id="fighter-grid">
        <button class="fighter-card" type="button" data-src="./assets/agrawal.png" aria-label="Select fighter 1">
          <img src="./assets/agrawal.png" alt="Fighter 1" loading="lazy" />
        </button>
        <button class="fighter-card" type="button" data-src="./assets/mintchev.png" aria-label="Select fighter 2">
          <img src="./assets/mintchev.png" alt="Fighter 2" loading="lazy" />
        </button>
        <button class="fighter-card" type="button" data-src="./assets/raz.png" aria-label="Select fighter 3">
          <img src="./assets/raz.png" alt="Fighter 3" loading="lazy" />
        </button>
        <button class="fighter-card" type="button" data-src="./assets/shah.png" aria-label="Select fighter 4">
          <img src="./assets/shah.png" alt="Fighter 4" loading="lazy" />
        </button>
        <button class="fighter-card" type="button" data-src="./assets/smyth.png" aria-label="Select fighter 5">
          <img src="./assets/smyth.png" alt="Fighter 5" loading="lazy" class="fighter-zoom" />
        </button>
      </div>
    </div>
  </div>

  <div id="game-overlay" class="overlay hidden" role="dialog" aria-modal="true">
    <div class="panel game-panel">
      <div class="game-header">
        <span id="score-pill" class="score-pill">Score: 0</span>
        <button id="game-close" class="game-close" type="button" aria-label="Close snake game">Ã—</button>
      </div>
      <canvas id="snake-canvas" class="game-canvas" width="420" height="420"></canvas>
      <div class="game-note">Use arrow keys or WASD to move.</div>
    </div>
  </div>

  <div id="win-overlay" class="overlay hidden" role="alert">
    <div class="win-panel">You Win!</div>
  </div>

  <div id="death-overlay" class="overlay hidden" role="alert">
    <img src="./assets/youdied.png" alt="YOU DIED" />
  </div>

  <script>
    const constructionBtn = document.getElementById("construction-btn");
    const fighterOverlay = document.getElementById("fighter-overlay");
    const gameOverlay = document.getElementById("game-overlay");
    const winOverlay = document.getElementById("win-overlay");
    const fighterGrid = document.getElementById("fighter-grid");
    const canvas = document.getElementById("snake-canvas");
    const scorePill = document.getElementById("score-pill");
    const gameCloseBtn = document.getElementById("game-close");
    const deathOverlay = document.getElementById("death-overlay");

    const ctx = canvas.getContext("2d");
    const gridSize = 20;
    const cellSize = canvas.width / gridSize;
    let snake = [];
    let direction = { x: 1, y: 0 };
    let nextDirection = { x: 1, y: 0 };
    let food = null;
    let score = 0;
    let running = false;
    let timerId = null;
    let fighterImg = null;
    let foodImg = new Image();
    foodImg.src = "./assets/cooper.png";

    function resetGame() {
      winOverlay.classList.add("hidden");
      deathOverlay.classList.add("hidden");
      snake = [
        { x: 9, y: 10 },
        { x: 8, y: 10 },
        { x: 7, y: 10 },
      ];
      direction = { x: 1, y: 0 };
      nextDirection = { x: 1, y: 0 };
      score = 0;
      updateScore();
      placeFood();
      running = true;
      if (timerId) clearInterval(timerId);
      timerId = setInterval(gameTick, 140);
    }

    function updateScore() {
      scorePill.textContent = `Score: ${score}`;
    }

    function placeFood() {
      const occupied = new Set(snake.map((seg) => `${seg.x},${seg.y}`));
      let x = 0;
      let y = 0;
      do {
        x = Math.floor(Math.random() * gridSize);
        y = Math.floor(Math.random() * gridSize);
      } while (occupied.has(`${x},${y}`));
      food = { x, y };
    }

    function drawCellImage(img, x, y) {
      ctx.drawImage(img, x * cellSize, y * cellSize, cellSize, cellSize);
    }

    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#0b0f1c";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (food && foodImg.complete) {
        drawCellImage(foodImg, food.x, food.y);
      }

      if (fighterImg) {
        for (const segment of snake) {
          drawCellImage(fighterImg, segment.x, segment.y);
        }
      }

      ctx.strokeStyle = "rgba(255,255,255,0.08)";
      ctx.lineWidth = 1;
      for (let i = 0; i <= gridSize; i++) {
        const pos = i * cellSize;
        ctx.beginPath();
        ctx.moveTo(pos, 0);
        ctx.lineTo(pos, canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, pos);
        ctx.lineTo(canvas.width, pos);
        ctx.stroke();
      }
    }

    function gameTick() {
      if (!running) return;
      direction = { ...nextDirection };
      const head = snake[0];
      const newHead = { x: head.x + direction.x, y: head.y + direction.y };

      if (newHead.x < 0 || newHead.x >= gridSize || newHead.y < 0 || newHead.y >= gridSize) {
        endGame();
        return;
      }

      if (snake.some((seg) => seg.x === newHead.x && seg.y === newHead.y)) {
        endGame();
        return;
      }

      snake.unshift(newHead);

      if (food && newHead.x === food.x && newHead.y === food.y) {
        score += 1;
        updateScore();
        if (snake.length === gridSize * gridSize) {
          winGame();
          return;
        }
        placeFood();
      } else {
        snake.pop();
      }

      drawBoard();
    }

    function endGame() {
      running = false;
      if (timerId) clearInterval(timerId);
      timerId = null;
      drawBoard();
      deathOverlay.classList.remove("hidden");
    }

    function winGame() {
      running = false;
      if (timerId) clearInterval(timerId);
      timerId = null;
      winOverlay.classList.remove("hidden");
      setTimeout(() => {
        window.location.href = "../";
      }, 5000);
    }

    function handleKey(e) {
      const key = e.key.toLowerCase();
      if (!running) return;
      if ((key === "arrowup" || key === "w") && direction.y !== 1) {
        nextDirection = { x: 0, y: -1 };
      } else if ((key === "arrowdown" || key === "s") && direction.y !== -1) {
        nextDirection = { x: 0, y: 1 };
      } else if ((key === "arrowleft" || key === "a") && direction.x !== 1) {
        nextDirection = { x: -1, y: 0 };
      } else if ((key === "arrowright" || key === "d") && direction.x !== -1) {
        nextDirection = { x: 1, y: 0 };
      }
    }

    constructionBtn.addEventListener("click", () => {
      fighterOverlay.classList.remove("hidden");
    });

    fighterGrid.addEventListener("click", (event) => {
      const card = event.target.closest(".fighter-card");
      if (!card) return;
      const src = card.getAttribute("data-src");
      if (!src) return;
      fighterImg = new Image();
      fighterImg.onload = () => {
        winOverlay.classList.add("hidden");
        deathOverlay.classList.add("hidden");
        fighterOverlay.classList.add("hidden");
        gameOverlay.classList.remove("hidden");
        resetGame();
        drawBoard();
      };
      fighterImg.src = src;
    });

    gameCloseBtn.addEventListener("click", () => {
      running = false;
      if (timerId) clearInterval(timerId);
      timerId = null;
      gameOverlay.classList.add("hidden");
      winOverlay.classList.add("hidden");
      deathOverlay.classList.add("hidden");
    });

    deathOverlay.addEventListener("click", (event) => {
      if (event.target !== deathOverlay) return;
      running = false;
      if (timerId) clearInterval(timerId);
      timerId = null;
      gameOverlay.classList.add("hidden");
      winOverlay.classList.add("hidden");
      deathOverlay.classList.add("hidden");
    });

    document.addEventListener("keydown", handleKey);
  </script>
</body>
</html>
